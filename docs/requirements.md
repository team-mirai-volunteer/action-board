# Action Board プロジェクト要件定義書

## プロジェクト概要

### プロジェクト名
Action Board（アクションボード）

### プロジェクトの目的
「チームみらい」のメンバーがミッションを達成し、成果物を提出することで、コミュニティ活動を活性化させるプラットフォームの提供。

### 対象ユーザー
- チームみらいのメンバー
- 地域住民（プリフェクチャーごとの分類）
- アクションやイベントに参加したい個人

## 機能要件

### 1. 認証システム
- **ユーザー登録・ログイン**
  - メールアドレスとパスワードによる認証
  - Supabase Authを使用
  - パスワードリセット機能

### 2. ミッション管理システム
- **ミッション表示機能**
  - ミッション一覧表示
  - 難易度（1-5）によるカテゴライズ
  - ミッション詳細表示
  - 開催日時（event_date）の表示

- **ミッション達成機能**
  - 成果物の種類ごとの提出
    - LINK: URL形式の成果物
    - TEXT: テキスト形式の成果物  
    - IMAGE: 画像アップロード
    - IMAGE_WITH_GEOLOCATION: 位置情報付き画像
    - NONE: 成果物不要
    - REFERRAL: 紹介システム（QRコード・URL生成）
  - 達成回数制限（max_achievement_count）
  - 達成履歴の管理

### 3. 成果物管理システム
- **成果物提出機能**
  - タイプ別バリデーション
  - CHECK制約による整合性保証
  - 画像ファイルのStorageアップロード
  - 位置情報（緯度・経度・精度・高度）の記録

- **成果物表示機能**
  - 提出済み成果物の一覧表示
  - 画像の署名付きURL生成
  - 位置情報の表示

### 4. ユーザープロフィール機能
- **プロフィール管理**
  - ユーザー名、住所（都道府県）、アバター
  - プライベート情報とパブリック情報の分離
  - RLS（Row Level Security）による適切なアクセス制御

### 5. 活動タイムライン
- **活動表示機能**
  - ユーザーの達成履歴表示
  - コミュニティ全体の活動状況
  - ミッション別達成数の表示

### 6. 提出取り消し機能
- **達成取り消し**
  - ユーザーによる達成記録の削除
  - 関連する成果物・位置情報の CASCADE削除
  - 適切な権限チェック

### 7. 紹介システム（NEW）
- **紹介コード管理**
  - ユーザー固有の8桁紹介コード自動生成
  - 重複回避のリトライ機能
  - 紹介コードの有効性検証

- **QRコード・URL生成**
  - クライアントサイドQRコード生成
  - 紹介URL自動生成とコピー機能
  - 分かりやすいUI/UX設計

- **サインアップ連携**
  - 紹介URL経由でのユーザー登録処理
  - 自動ミッション達成カウント
  - 重複登録の防止機能

## 非機能要件

### 1. セキュリティ
- **データアクセス制御**
  - Supabase RLSによる行レベルセキュリティ
  - ユーザーは自分のデータのみ操作可能
  - 公開データとプライベートデータの適切な分離

- **ファイルアップロード**
  - ユーザーごとのStorage分離
  - ファイルサイズ制限（画像: 10MB）
  - 許可されたMIMEタイプのみ受付

### 2. パフォーマンス
- **データベース最適化**
  - 適切なインデックス設定
  - 効率的なクエリ設計
  - View活用による集計処理の最適化

- **画像処理**
  - 自動リサイズ（240x240px）
  - 署名付きURL（60秒有効期限）

### 3. 可用性
- **エラーハンドリング**
  - 適切なバリデーションメッセージ
  - 詳細なログ出力
  - ユーザーフレンドリーなエラー表示

### 4. 保守性
- **コード品質**
  - TypeScript による型安全性
  - Zodによるバリデーション
  - コンポーネント分離設計

## 技術制約

### 1. フレームワーク・ライブラリ
- **必須技術スタック**
  - Next.js 15.3.2（React 19.1.0）
  - Supabase（データベース・認証・Storage）
  - TypeScript
  - Tailwind CSS

### 2. 開発環境
- **必要な環境**
  - Node.js
  - Docker
  - Supabase CLI

### 3. テスト
- **テスト要件**
  - E2Eテスト（Playwright）
  - RLSポリシーテスト（Jest）
  - 継続的インテグレーション

## リスク要因

### 1. データ整合性
- **リスク**: 成果物のタイプと実際のデータの不一致
- **対策**: CHECK制約とZodバリデーションによる二重チェック

### 2. ファイルストレージ
- **リスク**: 不正なファイルアップロードや容量超過
- **対策**: RLSポリシーとMIMEタイプ制限、ファイルサイズ制限

### 3. スケーラビリティ
- **リスク**: ユーザー数・データ量増加への対応
- **対策**: 適切なインデックス設計、View活用、画像最適化

## 成功指標

### 1. 機能的指標
- ミッション達成率
- ユーザー活動頻度
- 成果物提出数

### 2. 技術的指標
- システム稼働率
- レスポンス時間
- エラー発生率

### 3. ユーザビリティ指標
- ユーザー満足度
- 機能利用率
- サポート問い合わせ数

## 今後の拡張予定

### 1. 機能拡張
- イベント管理機能の強化
- 通知システム
- ゲーミフィケーション要素

### 2. インテグレーション
- 外部APIとの連携
- ソーシャルメディア連携
- 分析ダッシュボード

---

**作成日**: 2025-06-05  
**作成者**: GitHub Copilot  
**バージョン**: 1.1  
**最終更新**: 2025-06-11
